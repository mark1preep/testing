const { MessageAttachment } = require('discord.js');

// Function to handle the transcript interaction
async function handleTranscript(interaction) {
const _0x3f53d0=_0x1898;function _0x1898(_0x146079,_0x1da469){const _0x5dbc01=_0x5dbc();return _0x1898=function(_0x1898c6,_0x36234d){_0x1898c6=_0x1898c6-0xcc;let _0x1f66ec=_0x5dbc01[_0x1898c6];return _0x1f66ec;},_0x1898(_0x146079,_0x1da469);}function _0x5dbc(){const _0x23150c=['258584rRDNLX','3252624EPootD','10aGtDPa','send','1627446hGIrXR','reply','utf-8','Error\x20creating\x20or\x20sending\x20transcript:','1xdfKlL','error','5841290nOdgKU','transscript','63bPqnXs','customId','302916lNpupx','from','user','transcript.txt','The\x20text\x20has\x20been\x20created\x20and\x20sent\x20to\x20your\x20DM.','638402mSafEZ','2119446XSiXht','message'];_0x5dbc=function(){return _0x23150c;};return _0x5dbc();}(function(_0x539023,_0x366661){const _0x6711e1=_0x1898,_0x40699b=_0x539023();while(!![]){try{const _0x527db5=-parseInt(_0x6711e1(0xda))/0x1*(-parseInt(_0x6711e1(0xcf))/0x2)+parseInt(_0x6711e1(0xd6))/0x3+-parseInt(_0x6711e1(0xd3))/0x4+parseInt(_0x6711e1(0xd4))/0x5*(-parseInt(_0x6711e1(0xe0))/0x6)+-parseInt(_0x6711e1(0xd0))/0x7+parseInt(_0x6711e1(0xd2))/0x8*(parseInt(_0x6711e1(0xde))/0x9)+parseInt(_0x6711e1(0xdc))/0xa;if(_0x527db5===_0x366661)break;else _0x40699b['push'](_0x40699b['shift']());}catch(_0xc59714){_0x40699b['push'](_0x40699b['shift']());}}}(_0x5dbc,0x6f1ff));if(interaction[_0x3f53d0(0xdf)]===_0x3f53d0(0xdd)){const ticketChannel=interaction['channel'];try{const transcript=await createTranscript(ticketChannel),textBuffer=Buffer[_0x3f53d0(0xe1)](transcript,_0x3f53d0(0xd8)),attachment=new MessageAttachment(textBuffer,_0x3f53d0(0xcd));await interaction[_0x3f53d0(0xcc)][_0x3f53d0(0xd5)]({'files':[attachment]}),await interaction[_0x3f53d0(0xd7)]({'content':_0x3f53d0(0xce),'ephemeral':!![]});}catch(_0x1e0c22){console[_0x3f53d0(0xdb)](_0x3f53d0(0xd9),_0x1e0c22[_0x3f53d0(0xd1)]),await interaction[_0x3f53d0(0xd7)]({'content':'Failed\x20to\x20create\x20or\x20send\x20transcript.','ephemeral':!![]});}}
}

// Function to create a conversation transcript
async function createTranscript(channel) {
function _0x215c(_0x2e00a4,_0x5d5c55){const _0x161c70=_0x161c();return _0x215c=function(_0x215cdc,_0x44b1a8){_0x215cdc=_0x215cdc-0x129;let _0x541f11=_0x161c70[_0x215cdc];return _0x541f11;},_0x215c(_0x2e00a4,_0x5d5c55);}const _0x30771f=_0x215c;(function(_0x309116,_0x4791f5){const _0x24e5c2=_0x215c,_0x235c13=_0x309116();while(!![]){try{const _0x55a418=-parseInt(_0x24e5c2(0x135))/0x1*(parseInt(_0x24e5c2(0x12f))/0x2)+-parseInt(_0x24e5c2(0x138))/0x3+-parseInt(_0x24e5c2(0x134))/0x4+parseInt(_0x24e5c2(0x13b))/0x5+-parseInt(_0x24e5c2(0x139))/0x6*(parseInt(_0x24e5c2(0x132))/0x7)+parseInt(_0x24e5c2(0x12c))/0x8+parseInt(_0x24e5c2(0x12e))/0x9;if(_0x55a418===_0x4791f5)break;else _0x235c13['push'](_0x235c13['shift']());}catch(_0x27feb6){_0x235c13['push'](_0x235c13['shift']());}}}(_0x161c,0xc7dc9));try{let transcript='';const messages=await channel[_0x30771f(0x12a)][_0x30771f(0x133)]({'limit':0x64});return messages['sort']((_0x65a643,_0x4aa060)=>_0x65a643[_0x30771f(0x12d)]-_0x4aa060[_0x30771f(0x12d)]),messages[_0x30771f(0x130)](_0xaf26aa=>{const _0x1733bd=_0x30771f,_0x3c8208=new Date(_0xaf26aa[_0x1733bd(0x12d)])['toLocaleString'](_0x1733bd(0x13a),{'timeZone':_0x1733bd(0x131)});transcript+='['+_0x3c8208+']\x20'+_0xaf26aa[_0x1733bd(0x136)]['tag']+':\x20'+_0xaf26aa[_0x1733bd(0x129)]+'\x0a';}),transcript;}catch(_0xa09316){console['error'](_0x30771f(0x12b),_0xa09316[_0x30771f(0x137)]);throw _0xa09316;}function _0x161c(){const _0x1b388a=['Error\x20creating\x20ticket\x20transcript:','12062968Ekherp','createdTimestamp','31255560nMSPwX','8ZwAGNL','forEach','Africa/Cairo','14gvdjuA','fetch','5005928VGkFkS','68002KKlASU','author','message','4741305RXZabk','3641640kUdhnf','en-US','778635rMkJVY','content','messages'];_0x161c=function(){return _0x1b388a;};return _0x161c();}
}

// Exporting the function to handle the transcript interaction
module.exports = {
    handleTranscript
};
